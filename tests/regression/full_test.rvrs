flow giveDiscount() {
  return 0.10
}

flow computeTotal() {
  source base = 100.0
  delta discount = call giveDiscount()
  source total = base - (base * discount)

  echo discount         -- expect 0.10
  echo total            -- expect 90.0
  return total
}

flow shadowTest() {
  delta x = 5
  echo x
  branch truth {
    delta x = 99
    echo x
  }
  echo x
}

flow controlFlow() {
  source val = 42
  branch val == 42 {
    echo "The Answer"
  } else {
    echo "Wrong universe"
  }
}

flow expressionTest() {
  source x = 10 + 2 * 5 - 3 / 3
  echo x              -- expect 19.0
}

flow greet(name) {
  echo name
}

flow add(x, y) {
  delta result x + y
  echo result
}

flow argTest {
  call greet("Carlos")
  call add(7, 8)
}

flow testAssert {
  assert 1 == 1           -- should pass
  assert 2 == 3           -- should fail
  assert "hello"          -- non-boolean
}

flow logicTest {
  assert not void         -- expect true
  assert truth and truth  -- expect true
  assert truth or void    -- expect true
  assert void or void     -- expect false
}

flow divZeroTest {
  source fail = 10 / 0
  whisper fail
}

flow returnInsideBranch {
  branch truth {
    return 99
  }
  echo "This should not appear"
}

flow negationTest {
  source x = -42
  echo x
}

flow mouthError {
  mouth missingVar
}

flow main {
  echo "Testing RVRS full suite:"
  call shadowTest
  call controlFlow
  call expressionTest
  call logicTest
  call testAssert
  call divZeroTest
  call returnInsideBranch
  call negationTest
  call mouthError
  source result = call computeTotal()
  echo result
  call argTest
  mouth "âœ… All systems go"
}
